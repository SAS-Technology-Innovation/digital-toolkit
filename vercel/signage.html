<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EdTech Dashboard | SAS Digital Toolkit</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    :root {
      --sas-blue: #1a2d58;
      --sas-red: #a0192a;
      --eagle-yellow: #fabc00;
      /* AAA-compliant colors for text (7:1+ contrast on white) */
      --success-green: #065f46;  /* emerald-800: 7.4:1 */
      --warning-orange: #92400e; /* amber-800: 7.5:1 */
      --error-red: #991b1b;      /* red-800: 7.9:1 */
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-500: #374151;  /* Darkened for AAA: 7.8:1 */
      --gray-700: #374151;
      --gray-900: #111827;
      --elementary: #228ec2;
      --middle-school: #a0192a;
      --high-school: #1a2d58;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: linear-gradient(135deg, var(--sas-blue) 0%, #0f1a33 100%);
      color: white;
      min-height: 100vh;
      overflow: hidden;
    }

    /* Header */
    .header {
      background: rgba(0, 0, 0, 0.3);
      padding: 16px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      height: 48px;
      width: auto;
    }

    .header h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 1.75rem;
      letter-spacing: 2px;
      color: var(--eagle-yellow);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 24px;
      font-size: 0.875rem;
      opacity: 0.8;
    }

    .clock {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .date {
      opacity: 0.7;
    }

    /* Dashboard Grid */
    .dashboard {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: auto 1fr 1fr;
      gap: 20px;
      padding: 20px 32px;
      height: calc(100vh - 88px);
    }

    /* Panel Base Styles */
    .panel {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .panel-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      opacity: 0.9;
    }

    .panel-title i {
      width: 20px;
      height: 20px;
      opacity: 0.7;
    }

    .panel-badge {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 20px;
      font-weight: 600;
    }

    .panel-badge.success {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success-green);
    }

    .panel-badge.warning {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning-orange);
    }

    .panel-badge.error {
      background: rgba(239, 68, 68, 0.2);
      color: var(--error-red);
    }

    /* Status Overview - spans 2 columns */
    .status-panel {
      grid-column: span 2;
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
    }

    .status-stat {
      text-align: center;
      padding: 16px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
    }

    .status-stat .value {
      font-size: 2.5rem;
      font-weight: 700;
      line-height: 1;
    }

    .status-stat .value.green { color: var(--success-green); }
    .status-stat .value.yellow { color: var(--warning-orange); }
    .status-stat .value.red { color: var(--error-red); }

    .status-stat .label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.7;
      margin-top: 8px;
    }

    /* Down Detector Panel */
    .down-panel {
      grid-column: span 2;
    }

    .down-list {
      list-style: none;
      max-height: calc(100% - 50px);
      overflow-y: auto;
    }

    .down-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: rgba(239, 68, 68, 0.15);
      border-radius: 8px;
      margin-bottom: 8px;
      border-left: 3px solid var(--error-red);
    }

    .down-item i {
      color: var(--error-red);
      width: 20px;
      height: 20px;
    }

    .down-item .name {
      flex: 1;
      font-weight: 600;
    }

    .down-item .url {
      font-size: 0.75rem;
      opacity: 0.6;
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .all-operational {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: calc(100% - 50px);
      text-align: center;
    }

    .all-operational i {
      width: 64px;
      height: 64px;
      color: var(--success-green);
      margin-bottom: 16px;
    }

    .all-operational h3 {
      font-size: 1.25rem;
      margin-bottom: 4px;
    }

    .all-operational p {
      opacity: 0.7;
      font-size: 0.875rem;
    }

    /* Renewal Panel - spans 2 columns */
    .renewal-panel {
      grid-column: span 2;
    }

    .renewal-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 16px;
    }

    .renewal-stat {
      text-align: center;
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
    }

    .renewal-stat .value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--eagle-yellow);
    }

    .renewal-stat .label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.7;
      margin-top: 4px;
    }

    .renewal-list {
      list-style: none;
      max-height: calc(100% - 120px);
      overflow-y: auto;
    }

    .renewal-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      background: rgba(0, 0, 0, 0.15);
      border-radius: 8px;
      margin-bottom: 6px;
    }

    .renewal-item .name {
      font-weight: 500;
      flex: 1;
    }

    .renewal-item .date {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 20px;
      font-weight: 600;
    }

    .renewal-item .date.urgent {
      background: rgba(239, 68, 68, 0.2);
      color: var(--error-red);
    }

    .renewal-item .date.soon {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning-orange);
    }

    .renewal-item .date.normal {
      background: rgba(255, 255, 255, 0.1);
      opacity: 0.7;
    }

    /* Apps by Division Panel */
    .division-panel {
      grid-column: span 2;
    }

    .division-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      height: calc(100% - 50px);
    }

    .division-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
    }

    .division-card.whole-school {
      background: linear-gradient(135deg, rgba(250, 188, 0, 0.3), rgba(250, 188, 0, 0.1));
      border: 1px solid rgba(250, 188, 0, 0.3);
    }

    .division-card.elementary {
      background: linear-gradient(135deg, rgba(34, 142, 194, 0.3), rgba(34, 142, 194, 0.1));
      border: 1px solid rgba(34, 142, 194, 0.3);
    }

    .division-card.middle {
      background: linear-gradient(135deg, rgba(160, 25, 42, 0.3), rgba(160, 25, 42, 0.1));
      border: 1px solid rgba(160, 25, 42, 0.3);
    }

    .division-card.high {
      background: linear-gradient(135deg, rgba(26, 45, 88, 0.5), rgba(26, 45, 88, 0.2));
      border: 1px solid rgba(26, 45, 88, 0.5);
    }

    .division-card .count {
      font-size: 3rem;
      font-weight: 700;
      line-height: 1;
    }

    .division-card .label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.8;
      margin-top: 8px;
    }

    /* Recent Apps Panel */
    .recent-panel {
      grid-column: span 2;
    }

    .recent-list {
      list-style: none;
      max-height: calc(100% - 50px);
      overflow-y: auto;
    }

    .recent-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      background: rgba(0, 0, 0, 0.15);
      border-radius: 8px;
      margin-bottom: 6px;
    }

    .recent-item .logo {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      object-fit: contain;
      background: white;
      padding: 4px;
    }

    .recent-item .info {
      flex: 1;
    }

    .recent-item .name {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .recent-item .division {
      font-size: 0.7rem;
      opacity: 0.6;
    }

    .recent-item .date-badge {
      font-size: 0.65rem;
      padding: 3px 8px;
      background: rgba(16, 185, 129, 0.2);
      color: var(--success-green);
      border-radius: 20px;
      font-weight: 600;
    }

    /* License Types Panel */
    .license-panel {
      grid-column: span 2;
    }

    .license-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      height: calc(100% - 50px);
    }

    .license-card {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
    }

    .license-card i {
      width: 24px;
      height: 24px;
      opacity: 0.7;
    }

    .license-card .count {
      font-size: 1.75rem;
      font-weight: 700;
    }

    .license-card .label {
      font-size: 0.7rem;
      text-transform: uppercase;
      opacity: 0.6;
    }

    /* Enterprise highlight */
    .enterprise-count {
      grid-column: span 2;
      background: linear-gradient(135deg, rgba(250, 188, 0, 0.25), rgba(250, 188, 0, 0.1));
      border: 1px solid rgba(250, 188, 0, 0.3);
    }

    .enterprise-count .count {
      color: var(--eagle-yellow);
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Loading State */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      opacity: 0.5;
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid rgba(255, 255, 255, 0.2);
      border-top-color: var(--eagle-yellow);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Pulse animation for live indicator */
    .live-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: var(--success-green);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    /* Slide System */
    .slides-container {
      position: relative;
      height: calc(100vh - 88px);
      overflow: hidden;
    }

    .slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 20px 32px;
      display: grid;
      gap: 20px;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.8s ease-in-out;
      pointer-events: none;
    }

    .slide.active {
      opacity: 1;
      transform: translateX(0);
      pointer-events: auto;
    }

    .slide.inactive {
      opacity: 0;
      transform: translateX(-100%);
    }

    /* Slide 1: Status & Down Detector */
    .slide-1 {
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto 1fr;
    }

    .slide-1 .status-panel {
      grid-column: span 2;
    }

    /* Slide 2: Renewals & Division */
    .slide-2 {
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
    }

    /* Slide 3: Recent & License */
    .slide-3 {
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
    }

    /* Progress Indicator */
    .progress-bar {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 12px;
      z-index: 100;
    }

    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }

    .progress-dot.active {
      background: var(--eagle-yellow);
      transform: scale(1.3);
    }

    /* Fullscreen hint */
    .fullscreen-hint {
      position: fixed;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.75rem;
      opacity: 0.5;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .fullscreen-hint i {
      width: 14px;
      height: 14px;
    }

    /* Larger panels for full screen */
    .panel {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 20px;
      padding: 32px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }

    .panel-title {
      font-size: 1.1rem;
    }

    .panel-title i {
      width: 24px;
      height: 24px;
    }

    .status-stat .value {
      font-size: 4rem;
    }

    .status-stat .label {
      font-size: 1rem;
      margin-top: 12px;
    }

    .division-card .count {
      font-size: 5rem;
    }

    .division-card .label {
      font-size: 1rem;
    }

    .renewal-stat .value {
      font-size: 3rem;
    }

    .renewal-stat .label {
      font-size: 0.9rem;
    }

    .renewal-item, .recent-item, .down-item {
      padding: 16px 20px;
      font-size: 1.1rem;
    }

    .license-card .count {
      font-size: 2.5rem;
    }

    .license-card .label {
      font-size: 0.9rem;
    }

    .all-operational i {
      width: 100px;
      height: 100px;
    }

    .all-operational h3 {
      font-size: 2rem;
    }

    .all-operational p {
      font-size: 1.25rem;
    }

    /* Skip Link - Accessibility */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--sas-blue);
      color: white;
      padding: 8px 16px;
      z-index: 10000;
      text-decoration: none;
      font-weight: 600;
      border-radius: 0 0 4px 0;
    }
    .skip-link:focus {
      top: 0;
      outline: 3px solid var(--eagle-yellow);
      outline-offset: 2px;
    }

    /* Accessible Alternative Banner */
    .a11y-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--eagle-yellow);
      color: var(--gray-900);
      padding: 8px 16px;
      text-align: center;
      font-size: 0.875rem;
      font-weight: 600;
      z-index: 9999;
      transform: translateY(-100%);
      transition: transform 0.3s ease;
    }
    .a11y-banner:focus-within {
      transform: translateY(0);
    }
    .a11y-banner a {
      color: var(--sas-blue);
      text-decoration: underline;
    }
    .a11y-banner a:focus {
      outline: 2px solid var(--sas-blue);
      outline-offset: 2px;
    }

    /* Respect reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
      .live-dot {
        animation: none;
      }
      .slide {
        transition: none;
      }
    }

    /* Screen reader only - visually hidden but accessible */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* AAA-compliant focus indicators */
    :focus-visible {
      outline: 3px solid var(--eagle-yellow);
      outline-offset: 2px;
    }

    button:focus-visible,
    a:focus-visible,
    [tabindex]:focus-visible {
      outline: 3px solid var(--eagle-yellow);
      outline-offset: 2px;
    }

    /* WCAG 2.2 AAA: Minimum target size 24x24px (Success Criterion 2.5.8) */
    button,
    [role="button"],
    input[type="checkbox"],
    input[type="radio"],
    select {
      min-width: 24px;
      min-height: 24px;
    }
  </style>
</head>
<body>
  <!-- Accessible Alternative Banner - Visible on focus for keyboard users -->
  <div class="a11y-banner" role="region" aria-label="Accessibility notice">
    This display auto-advances. For an accessible version, <a href="/">visit the main dashboard</a>.
  </div>

  <!-- Skip Link for Keyboard Navigation -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <header class="header">
    <div class="header-left">
      <img src="/assets/sas-logo-white.png" alt="SAS" class="logo" onerror="this.style.display='none'">
      <h1>EdTech Team Dashboard</h1>
    </div>
    <div class="header-right">
      <div class="live-indicator" aria-label="Live data indicator">
        <span class="live-dot" aria-hidden="true"></span>
        <span>LIVE</span>
      </div>
      <div class="date" id="current-date" aria-label="Current date">--</div>
      <div class="clock" id="current-time" aria-label="Current time">--:--</div>
    </div>
  </header>

  <main id="main-content" class="slides-container" aria-label="Dashboard slides">
    <!-- Slide 1: Status Overview & Down Detector -->
    <div class="slide slide-1 active">
      <section class="panel status-panel">
        <div class="panel-header">
          <div class="panel-title">
            <i data-lucide="activity"></i>
            System Status
          </div>
          <span id="status-badge" class="panel-badge success">All Operational</span>
        </div>
        <div class="status-grid">
          <div class="status-stat">
            <div id="stat-total" class="value">--</div>
            <div class="label">Total Apps</div>
          </div>
          <div class="status-stat">
            <div id="stat-up" class="value green">--</div>
            <div class="label">Online</div>
          </div>
          <div class="status-stat">
            <div id="stat-down" class="value red">--</div>
            <div class="label">Issues</div>
          </div>
          <div class="status-stat">
            <div id="stat-uptime" class="value green">--</div>
            <div class="label">Uptime</div>
          </div>
        </div>
      </section>

      <section class="panel down-panel">
        <div class="panel-header">
          <div class="panel-title">
            <i data-lucide="alert-triangle"></i>
            Down Detector
          </div>
        </div>
        <div id="down-detector-content">
          <div class="all-operational">
            <i data-lucide="check-circle-2"></i>
            <h3>All Systems Operational</h3>
            <p>No issues detected</p>
          </div>
        </div>
      </section>

      <section class="panel division-panel">
        <div class="panel-header">
          <div class="panel-title">
            <i data-lucide="layout-grid"></i>
            Apps by Division
          </div>
        </div>
        <div class="division-grid">
          <div class="division-card whole-school">
            <div id="div-whole" class="count">--</div>
            <div class="label">Whole School</div>
          </div>
          <div class="division-card elementary">
            <div id="div-elem" class="count">--</div>
            <div class="label">Elementary</div>
          </div>
          <div class="division-card middle">
            <div id="div-middle" class="count">--</div>
            <div class="label">Middle School</div>
          </div>
          <div class="division-card high">
            <div id="div-high" class="count">--</div>
            <div class="label">High School</div>
          </div>
        </div>
      </section>
    </div>

    <!-- Slide 2: Renewals & Spend -->
    <div class="slide slide-2">
      <section class="panel renewal-panel" style="grid-column: span 2;">
        <div class="panel-header">
          <div class="panel-title">
            <i data-lucide="calendar-clock"></i>
            Upcoming Renewals
          </div>
        </div>
        <div class="renewal-stats">
          <div class="renewal-stat">
            <div id="renewal-30" class="value">--</div>
            <div class="label">Next 30 Days</div>
          </div>
          <div class="renewal-stat">
            <div id="renewal-90" class="value">--</div>
            <div class="label">Next 90 Days</div>
          </div>
          <div class="renewal-stat">
            <div id="renewal-total-spend" class="value">--</div>
            <div class="label">Est. Annual Spend</div>
          </div>
        </div>
        <ul id="renewal-list" class="renewal-list">
          <li class="loading"><div class="spinner"></div></li>
        </ul>
      </section>

      <section class="panel license-panel" style="grid-column: span 2;">
        <div class="panel-header">
          <div class="panel-title">
            <i data-lucide="key"></i>
            License Overview
          </div>
        </div>
        <div class="license-grid">
          <div class="license-card enterprise-count">
            <i data-lucide="award"></i>
            <div>
              <div id="license-enterprise" class="count">--</div>
              <div class="label">Enterprise Apps</div>
            </div>
          </div>
          <div class="license-card">
            <i data-lucide="building-2"></i>
            <div>
              <div id="license-site" class="count">--</div>
              <div class="label">Site Licenses</div>
            </div>
          </div>
          <div class="license-card">
            <i data-lucide="user"></i>
            <div>
              <div id="license-individual" class="count">--</div>
              <div class="label">Individual</div>
            </div>
          </div>
          <div class="license-card">
            <i data-lucide="gift"></i>
            <div>
              <div id="license-free" class="count">--</div>
              <div class="label">Free Apps</div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Slide 3: Recent Activity -->
    <div class="slide slide-3">
      <section class="panel recent-panel" style="grid-column: span 2; grid-row: span 2;">
        <div class="panel-header">
          <div class="panel-title">
            <i data-lucide="sparkles"></i>
            Recently Added Apps
          </div>
          <span class="panel-badge success" id="recent-count">0 new</span>
        </div>
        <ul id="recent-list" class="recent-list">
          <li class="loading"><div class="spinner"></div></li>
        </ul>
      </section>
    </div>
  </main>

  <!-- Progress Indicator -->
  <div class="progress-bar">
    <div class="progress-dot active"></div>
    <div class="progress-dot"></div>
    <div class="progress-dot"></div>
  </div>

  <div class="fullscreen-hint">
    <i data-lucide="maximize"></i>
    Click anywhere for fullscreen
  </div>

  <script>
    // Configuration
    const REFRESH_INTERVAL = 300000; // 5 minutes - data refresh
    const SLIDE_DURATION = 120000; // 2 minutes per slide
    const RECENT_DAYS = 60; // Days to consider "recently added"

    let appData = null;
    let statusData = null;
    let currentSlide = 0;
    const totalSlides = 3;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      lucide.createIcons();
      updateClock();
      setInterval(updateClock, 1000);
      loadAllData();
      setInterval(loadAllData, REFRESH_INTERVAL);

      // Start slide rotation
      setInterval(nextSlide, SLIDE_DURATION);

      // Request fullscreen on click (for initial setup)
      document.body.addEventListener('click', requestFullscreen);
    });

    function requestFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.log('Fullscreen not available:', err);
        });
      }
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % totalSlides;
      showSlide(currentSlide);
    }

    function showSlide(slideIndex) {
      const slides = document.querySelectorAll('.slide');
      slides.forEach((slide, index) => {
        if (index === slideIndex) {
          slide.classList.add('active');
          slide.classList.remove('inactive');
        } else {
          slide.classList.remove('active');
          slide.classList.add('inactive');
        }
      });

      // Update progress dots
      const dots = document.querySelectorAll('.progress-dot');
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === slideIndex);
      });
    }

    function updateClock() {
      const now = new Date();
      document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', {
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
      });
      document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', {
        weekday: 'long',
        month: 'short',
        day: 'numeric'
      });
    }

    async function loadAllData() {
      try {
        // Load app data and status data in parallel
        const [appResponse, statusResponse] = await Promise.all([
          fetch('/api/data'),
          fetch('/api/status')
        ]);

        appData = await appResponse.json();
        statusData = await statusResponse.json();

        updateStatusPanel();
        updateDownDetector();
        updateRenewalPanel();
        updateDivisionPanel();
        updateRecentPanel();
        updateLicensePanel();

        lucide.createIcons();
      } catch (error) {
        console.error('Error loading data:', error);
      }
    }

    function updateStatusPanel() {
      const summary = statusData?.summary || {};

      document.getElementById('stat-total').textContent = summary.total || 0;
      document.getElementById('stat-up').textContent = summary.up || 0;
      document.getElementById('stat-down').textContent = summary.down || 0;
      document.getElementById('stat-uptime').textContent = summary.uptime ? `${summary.uptime}%` : '--';

      // Update badge
      const badge = document.getElementById('status-badge');
      if (summary.down > 0) {
        badge.textContent = `${summary.down} Issue${summary.down > 1 ? 's' : ''}`;
        badge.className = 'panel-badge error';
      } else {
        badge.textContent = 'All Operational';
        badge.className = 'panel-badge success';
      }

      // Color coding for uptime
      const uptimeEl = document.getElementById('stat-uptime');
      uptimeEl.className = 'value';
      if (summary.uptime >= 99) uptimeEl.classList.add('green');
      else if (summary.uptime >= 95) uptimeEl.classList.add('yellow');
      else if (summary.uptime) uptimeEl.classList.add('red');
    }

    function updateDownDetector() {
      const container = document.getElementById('down-detector-content');
      const statuses = statusData?.statuses || {};

      // Find apps that are down
      const downApps = [];
      const allApps = getAllApps();

      allApps.forEach(app => {
        if (statuses[app.product] === 0) {
          downApps.push(app);
        }
      });

      if (downApps.length === 0) {
        container.innerHTML = `
          <div class="all-operational">
            <i data-lucide="check-circle-2"></i>
            <h3>All Systems Operational</h3>
            <p>No issues detected</p>
          </div>
        `;
      } else {
        container.innerHTML = `
          <ul class="down-list">
            ${downApps.slice(0, 8).map(app => `
              <li class="down-item">
                <i data-lucide="alert-circle"></i>
                <span class="name">${escapeHtml(app.product)}</span>
                <span class="url">${escapeHtml(app.website || '')}</span>
              </li>
            `).join('')}
          </ul>
        `;
      }
    }

    function updateRenewalPanel() {
      const allApps = getAllApps();
      const now = new Date();
      const thirtyDays = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
      const ninetyDays = new Date(now.getTime() + 90 * 24 * 60 * 60 * 1000);

      // Filter apps with renewal dates
      const appsWithRenewal = allApps.filter(app => app.renewalDate);

      // Count renewals in next 30 and 90 days
      let count30 = 0;
      let count90 = 0;
      let totalSpend = 0;
      const upcoming = [];

      appsWithRenewal.forEach(app => {
        const renewalDate = new Date(app.renewalDate);
        const spend = parseFloat(app.spend || app.value) || 0;
        totalSpend += spend;

        if (renewalDate <= thirtyDays && renewalDate >= now) {
          count30++;
          upcoming.push({ ...app, date: renewalDate, urgency: 'urgent' });
        } else if (renewalDate <= ninetyDays && renewalDate >= now) {
          count90++;
          upcoming.push({ ...app, date: renewalDate, urgency: 'soon' });
        }
      });

      document.getElementById('renewal-30').textContent = count30;
      document.getElementById('renewal-90').textContent = count90;
      document.getElementById('renewal-total-spend').textContent = formatCurrency(totalSpend);

      // Sort by date and show upcoming renewals
      upcoming.sort((a, b) => a.date - b.date);

      const list = document.getElementById('renewal-list');
      if (upcoming.length === 0) {
        list.innerHTML = '<li style="text-align: center; opacity: 0.5; padding: 20px;">No upcoming renewals</li>';
      } else {
        list.innerHTML = upcoming.slice(0, 8).map(app => `
          <li class="renewal-item">
            <span class="name">${escapeHtml(app.product)}</span>
            <span class="date ${app.urgency}">${formatDate(app.date)}</span>
          </li>
        `).join('');
      }
    }

    function updateDivisionPanel() {
      const wholeSchool = appData?.wholeSchool?.apps?.length || 0;
      const elementary = appData?.elementary?.apps?.length || 0;
      const middleSchool = appData?.middleSchool?.apps?.length || 0;
      const highSchool = appData?.highSchool?.apps?.length || 0;

      document.getElementById('div-whole').textContent = wholeSchool;
      document.getElementById('div-elem').textContent = elementary;
      document.getElementById('div-middle').textContent = middleSchool;
      document.getElementById('div-high').textContent = highSchool;
    }

    function updateRecentPanel() {
      const allApps = getAllApps();
      const now = new Date();
      const thresholdDate = new Date(now.getTime() - RECENT_DAYS * 24 * 60 * 60 * 1000);

      // Find recently added apps
      const recentApps = allApps.filter(app => {
        if (!app.dateAdded) return false;
        const addedDate = new Date(app.dateAdded);
        return addedDate >= thresholdDate;
      }).sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));

      document.getElementById('recent-count').textContent = `${recentApps.length} new`;

      const list = document.getElementById('recent-list');
      if (recentApps.length === 0) {
        list.innerHTML = '<li style="text-align: center; opacity: 0.5; padding: 20px;">No recent additions</li>';
      } else {
        list.innerHTML = recentApps.slice(0, 8).map(app => `
          <li class="recent-item">
            ${app.logoUrl ? `<img src="${escapeHtml(app.logoUrl)}" class="logo" alt="" onerror="this.style.display='none'">` : ''}
            <div class="info">
              <div class="name">${escapeHtml(app.product)}</div>
              <div class="division">${escapeHtml(app.division || '')}</div>
            </div>
            <span class="date-badge">${formatDate(new Date(app.dateAdded))}</span>
          </li>
        `).join('');
      }
    }

    function updateLicensePanel() {
      const allApps = getAllApps();

      let enterprise = 0;
      let site = 0;
      let individual = 0;
      let free = 0;

      allApps.forEach(app => {
        if (app.enterprise) enterprise++;

        const licenseType = (app.licenseType || '').toLowerCase();
        if (licenseType.includes('site') || licenseType.includes('school') || licenseType.includes('enterprise')) {
          site++;
        } else if (licenseType.includes('individual')) {
          individual++;
        } else if (licenseType.includes('free') || licenseType === '') {
          free++;
        }
      });

      document.getElementById('license-enterprise').textContent = enterprise;
      document.getElementById('license-site').textContent = site;
      document.getElementById('license-individual').textContent = individual;
      document.getElementById('license-free').textContent = free;
    }

    // Helper functions
    function getAllApps() {
      const apps = [];
      const seen = new Set();
      const divisions = ['wholeSchool', 'elementary', 'middleSchool', 'highSchool'];

      divisions.forEach(division => {
        if (appData?.[division]?.apps) {
          appData[division].apps.forEach(app => {
            if (!seen.has(app.product)) {
              seen.add(app.product);
              apps.push(app);
            }
          });
        }
      });

      return apps;
    }

    function formatCurrency(amount) {
      if (amount >= 1000000) {
        return `$${(amount / 1000000).toFixed(1)}M`;
      } else if (amount >= 1000) {
        return `$${(amount / 1000).toFixed(0)}K`;
      }
      return `$${amount.toFixed(0)}`;
    }

    function formatDate(date) {
      return date.toLocaleDateString('en-US', {
        month: 'short',
        day: 'numeric'
      });
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>
</body>
</html>
