# Cloudflare Workers configuration for SAS Digital Toolkit Dashboard
# See: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "sas-digital-toolkit"
main = "worker.js"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Specify the account ID (get this from your Cloudflare dashboard)
# account_id = "your-account-id-here"

# KV Namespace for dynamic data updates (optional)
# If you want to update the JSON data without redeploying, use KV:
# [[kv_namespaces]]
# binding = "DASHBOARD_DATA"
# id = "your-kv-namespace-id"
# preview_id = "your-preview-kv-namespace-id"

# Environment variables
[vars]
ENVIRONMENT = "development"

# ⚠️  SECURITY CONFIGURATION (CRITICAL FOR PRODUCTION) ⚠️
#
# For DEVELOPMENT: Use wildcards (allows all origins)
# ALLOWED_ORIGINS = "*"
# FRAME_ANCESTORS = "*"
#
# For PRODUCTION: ALWAYS restrict to specific domains!
# ALLOWED_ORIGINS = "https://yourdomain.com,https://docs.yourdomain.com"
# FRAME_ANCESTORS = "https://yourdomain.com https://docs.yourdomain.com"
#
# Example for SAS:
# ALLOWED_ORIGINS = "https://sas.edu.sg,https://docs.sas.edu.sg"
# FRAME_ANCESTORS = "https://sas.edu.sg https://docs.sas.edu.sg"
#
# ⚠️  WARNING: Wildcard (*) in production allows embedding from ANY site,
#    which could enable clickjacking and data exposure. Always restrict!
#
# See cloudflare-worker/SECURITY.md for detailed guidelines

# Production environment configuration (RECOMMENDED)
# Uncomment and configure before deploying to production
[env.production]
vars = {
  ENVIRONMENT = "production",
  ALLOWED_ORIGINS = "https://sas.edu.sg,https://script.google.com,https://mintlify.app,https://sas-innovation.workers.dev",
  FRAME_ANCESTORS = "https://sas.edu.sg https://script.google.com https://mintlify.app https://sas-innovation.workers.dev"
}

# Custom routes (optional - for custom domains)
# [[routes]]
# pattern = "toolkit.yourdomain.com/*"
# zone_name = "yourdomain.com"

# Rules for bundling - tell wrangler to include HTML and JSON
[rules]
# Allow importing .html files as text
[[rules]]
type = "Text"
globs = ["**/*.html"]

# Allow importing .json files as modules
[[rules]]
type = "Data"
globs = ["**/*.json"]
